/* =======================================================================
   Textured Callouts v4 — Live Preview / Preview 공통
   사용: 콜아웃 안 첫 줄에  ![[Assets/textures/parchment.png|callbg]]
   레이어: 이미지(z0) < 틴트(z1) < 제목/아이콘/본문(z2~3)
   ======================================================================= */

/* 0) 콜아웃: 스태킹 컨텍스트 + 라운드 클립 */
.callout{
  position: relative;
  isolation: isolate;   /* z-index 충돌 차단(신규 스택컨텍스트) */
  overflow: hidden;
}

/* 1) 마커가 있을 때: 테마 스트립/내부배경 제거 + 공통 변수 */
.callout:has(img[alt~="callbg"]){
  --callbg-fit: cover;
  --callbg-tint: rgba(0,0,0,.12);
  --callbg-title: rgba(0,0,0,.18);
  --callbg-fg: var(--text-normal, #e6e6e6);
  background: transparent !important;
  --callout-color: transparent !important;
  border-left: 0 !important;
}

/* 2) 제목/본문/아이콘은 항상 최상단 */
.callout:has(img[alt~="callbg"]) .callout-title,
.callout:has(img[alt~="callbg"]) .callout-content{
  position: relative !important;
  z-index: 2 !important;
  background: transparent !important;
  color: var(--callbg-fg) !important;
}
.callout:has(img[alt~="callbg"]) .callout-title{
  background: var(--callbg-title) !important;
}
.callout:has(img[alt~="callbg"]) .callout-title .callout-icon{
  position: relative !important; z-index: 3 !important;
}

/* 3) 배경 임베드(읽기/프리뷰 공통): 컨테이너/이미지 절대배치 & 맨 아래 */
.callout :is(.internal-embed.image-embed,.image-embed):has(> img[alt~="callbg"]),
.callout .cm-embed-block:has(> .image-embed > img[alt~="callbg"]){
  position: absolute !important;
  inset: 0 !important;
  z-index: 0 !important;
  pointer-events: none !important;
  display: block !important;
}
.callout img[alt~="callbg"]{
  position: absolute !important;
  inset: 0 !important;
  width: 100% !important; height: 100% !important;
  object-fit: var(--callbg-fit) !important;
  border-radius: inherit !important;
}

/* 4) 가독성 틴트 — 이미지(z0) 위, 텍스트(z2) 아래 */
.callout:has(img[alt~="callbg"])::before{
  content:""; position:absolute; inset:0; z-index:1;
  background: var(--callbg-tint); border-radius: inherit;
}

/* 5) 마커 줄(임베드만 단독인 줄)은 높이/여백 제거 대신 '박스 제거'로 안전 처리 */
.callout .callout-content > :is(p,div):has(> .internal-embed.image-embed:only-child),
.callout .callout-content > :is(p,div):has(> .cm-embed-block:only-child){
  display: contents !important;  /* 상자 자체 제거 → 텍스트 줄 안 가림 */
}

/* 6) 내용이 없어도 배경이 보이도록 최소 높이(원하면 값 조절) */
.callout:has(img[alt~="callbg"]) .callout-content{ min-height: 160px; }

/* 7) (선택) 높이 프리셋 */
.callout .callout-content:has(> .bg-h-180){ min-height:180px; }
.callout .callout-content:has(> .bg-h-200){ min-height:200px; }
.callout .callout-content:has(> .bg-h-220){ min-height:220px; }
.callout .callout-content:has(> .bg-h-260){ min-height:260px; }
.callout .callout-content:has(> .bg-h-300){ min-height:300px; }

/* 8) 타입별 틴트(선택) */
.callout[data-callout="parchment"]{ --callbg-tint: rgba(0,0,0,.10); }
.callout[data-callout="leather"]  { --callbg-tint: rgba(0,0,0,.16); }
.callout[data-callout="paper"]    { --callbg-tint: rgba(255,255,255,0); --callbg-title: rgba(0,0,0,.10); }
